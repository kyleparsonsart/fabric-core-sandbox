<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fabric Â· Type Token Sandbox</title>
<style>
  /* â”€â”€ Apollo-adjacent design system â”€â”€ */
  :root {
    --bg-page:        #F5F5F4;
    --bg-surface:     #FFFFFF;
    --bg-surface-2:   #F9F9F8;
    --bg-dark:        #18181B;
    --bg-dark-surface:#27272A;
    --border:         #E4E4E7;
    --border-dark:    #3F3F46;
    --text-primary:   #18181B;
    --text-secondary: #71717A;
    --text-tertiary:  #A1A1AA;
    --text-on-dark:   #FAFAFA;
    --text-muted-dark:#A1A1AA;
    --accent:         #FF5B35;
    --accent-hover:   #E64D28;
    --pass:           #16A34A;
    --pass-bg:        #F0FDF4;
    --pass-border:    #BBF7D0;
    --fail:           #DC2626;
    --fail-bg:        #FEF2F2;
    --fail-border:    #FECACA;
    --warn:           #D97706;
    --warn-bg:        #FFFBEB;
    --warn-border:    #FDE68A;
    --radius:         6px;
    --radius-lg:      10px;
    --shadow:         0 1px 3px rgba(0,0,0,0.08), 0 1px 2px rgba(0,0,0,0.04);
    --shadow-md:      0 4px 12px rgba(0,0,0,0.08), 0 2px 4px rgba(0,0,0,0.04);
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    background: var(--bg-page);
    color: var(--text-primary);
    font-size: 13px;
    line-height: 1.5;
    min-height: 100vh;
  }

  /* â”€â”€ Top nav â”€â”€ */
  .topnav {
    background: var(--bg-surface);
    border-bottom: 1px solid var(--border);
    padding: 0 24px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    height: 52px;
    position: sticky;
    top: 0;
    z-index: 100;
    box-shadow: var(--shadow);
  }

  .nav-left {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .fabric-logo {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 14px;
    font-weight: 700;
    letter-spacing: -0.3px;
    color: var(--text-primary);
  }

  .fabric-logo .logo-mark {
    width: 26px;
    height: 26px;
    background: var(--accent);
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 12px;
    font-weight: 800;
    letter-spacing: -0.5px;
  }

  .nav-breadcrumb {
    display: flex;
    align-items: center;
    gap: 6px;
    color: var(--text-secondary);
    font-size: 12.5px;
  }

  .nav-breadcrumb .sep { color: var(--text-tertiary); }
  .nav-breadcrumb .current { color: var(--text-primary); font-weight: 500; }

  .nav-right {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .badge-phase {
    background: #FFF7ED;
    color: #C2410C;
    border: 1px solid #FED7AA;
    border-radius: 20px;
    padding: 2px 10px;
    font-size: 11px;
    font-weight: 600;
    letter-spacing: 0.3px;
  }

  /* â”€â”€ Page layout â”€â”€ */
  .page {
    max-width: 1280px;
    margin: 0 auto;
    padding: 28px 24px 60px;
  }

  .page-header {
    margin-bottom: 24px;
  }

  .page-header h1 {
    font-size: 22px;
    font-weight: 700;
    letter-spacing: -0.5px;
    margin-bottom: 4px;
  }

  .page-header p {
    color: var(--text-secondary);
    font-size: 13px;
  }

  /* â”€â”€ Global controls â”€â”€ */
  .controls-bar {
    background: var(--bg-surface);
    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
    padding: 14px 18px;
    display: flex;
    align-items: center;
    gap: 20px;
    margin-bottom: 20px;
    flex-wrap: wrap;
    box-shadow: var(--shadow);
  }

  .control-group {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .control-label {
    font-size: 11.5px;
    font-weight: 600;
    color: var(--text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.4px;
    white-space: nowrap;
  }

  .text-input {
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 6px 10px;
    font-size: 13px;
    color: var(--text-primary);
    background: var(--bg-surface-2);
    width: 240px;
    outline: none;
    transition: border-color 0.15s;
    font-family: inherit;
  }

  .text-input:focus { border-color: var(--accent); }

  .surface-toggle {
    display: flex;
    background: var(--bg-page);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 2px;
    gap: 2px;
  }

  .surface-btn {
    padding: 5px 12px;
    border-radius: 4px;
    border: none;
    background: transparent;
    font-size: 12px;
    font-weight: 500;
    cursor: pointer;
    color: var(--text-secondary);
    transition: all 0.15s;
    white-space: nowrap;
  }

  .surface-btn.active {
    background: var(--bg-surface);
    color: var(--text-primary);
    box-shadow: var(--shadow);
  }

  .surface-btn.dark-btn.active {
    background: var(--bg-dark);
    color: var(--text-on-dark);
  }

  .divider { width: 1px; height: 28px; background: var(--border); margin: 0 4px; }

  /* filter pills */
  .filter-pills {
    display: flex;
    gap: 4px;
  }

  .pill {
    padding: 4px 10px;
    border-radius: 20px;
    border: 1px solid var(--border);
    font-size: 11.5px;
    font-weight: 500;
    cursor: pointer;
    background: transparent;
    color: var(--text-secondary);
    transition: all 0.15s;
  }

  .pill.active { background: var(--text-primary); color: white; border-color: var(--text-primary); }
  .pill.high.active { background: var(--fail); border-color: var(--fail); }
  .pill.medium.active { background: var(--warn); border-color: var(--warn); }

  /* â”€â”€ Token cards grid â”€â”€ */
  .tokens-grid {
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .token-card {
    background: var(--bg-surface);
    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
    overflow: hidden;
    box-shadow: var(--shadow);
    transition: box-shadow 0.15s;
  }

  .token-card:hover { box-shadow: var(--shadow-md); }
  .token-card.hidden { display: none; }

  .token-card.priority-high  { border-left: 3px solid var(--fail); }
  .token-card.priority-medium { border-left: 3px solid var(--warn); }

  .card-header {
    display: grid;
    grid-template-columns: 220px 140px 80px 80px 90px 100px 1fr auto;
    align-items: center;
    gap: 0;
    padding: 0;
    cursor: pointer;
    user-select: none;
  }

  .card-header:hover { background: var(--bg-surface-2); }

  .card-cell {
    padding: 13px 14px;
    border-right: 1px solid var(--border);
    font-size: 12.5px;
    min-height: 48px;
    display: flex;
    align-items: center;
  }

  .card-cell:last-child { border-right: none; }

  .token-name-cell {
    font-family: 'SF Mono', 'Fira Code', monospace;
    font-size: 12px;
    font-weight: 600;
    color: var(--text-primary);
    gap: 6px;
  }

  .chip {
    display: inline-block;
    padding: 1px 6px;
    border-radius: 4px;
    font-family: 'SF Mono', monospace;
    font-size: 10px;
    background: #FDE8E8;
    color: #B91C1C;
    white-space: nowrap;
  }

  .chip-new {
    background: #E0F2FE;
    color: #0369A1;
    font-family: inherit;
    font-size: 10px;
    font-weight: 700;
  }

  .meta-val { color: var(--text-primary); }
  .meta-label { font-size: 10px; color: var(--text-tertiary); margin-top: 1px; }

  /* WCAG badge */
  .wcag-badge {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    padding: 3px 8px;
    border-radius: 20px;
    font-size: 10.5px;
    font-weight: 600;
    white-space: nowrap;
  }

  .wcag-large    { background: var(--pass-bg);  color: var(--pass);  border: 1px solid var(--pass-border); }
  .wcag-standard { background: var(--warn-bg);  color: var(--warn);  border: 1px solid var(--warn-border); }

  /* Priority badge */
  .priority-badge {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    padding: 2px 8px;
    border-radius: 20px;
    font-size: 10.5px;
    font-weight: 600;
  }

  .p-high   { background: var(--fail-bg);  color: var(--fail);  border: 1px solid var(--fail-border); }
  .p-medium { background: var(--warn-bg);  color: var(--warn);  border: 1px solid var(--warn-border); }
  .p-none   { background: var(--pass-bg);  color: var(--pass);  border: 1px solid var(--pass-border); }

  /* expand toggle */
  .expand-btn {
    padding: 13px 16px;
    background: none;
    border: none;
    cursor: pointer;
    color: var(--text-tertiary);
    font-size: 16px;
    line-height: 1;
    transition: color 0.15s, transform 0.2s;
    display: flex;
    align-items: center;
  }

  .token-card.expanded .expand-btn { transform: rotate(180deg); color: var(--accent); }

  /* â”€â”€ Expanded panel â”€â”€ */
  .card-panel {
    display: none;
    border-top: 1px solid var(--border);
  }

  .token-card.expanded .card-panel { display: grid; grid-template-columns: 1fr 1fr; }

  .panel-preview {
    padding: 24px;
    border-right: 1px solid var(--border);
    transition: background 0.2s;
  }

  .panel-preview.dark-surface {
    background: var(--bg-dark);
  }

  .preview-label {
    font-size: 10.5px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: var(--text-tertiary);
    margin-bottom: 16px;
  }

  .panel-preview.dark-surface .preview-label { color: var(--text-muted-dark); }

  .preview-text {
    transition: color 0.2s;
    word-break: break-word;
  }

  .panel-preview.dark-surface .preview-text { color: var(--text-on-dark); }

  /* WCAG live checker */
  .wcag-live {
    margin-top: 20px;
    padding: 12px 14px;
    border-radius: var(--radius);
    font-size: 12px;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .wcag-live.pass { background: var(--pass-bg); color: var(--pass); border: 1px solid var(--pass-border); }
  .wcag-live.fail { background: var(--fail-bg); color: var(--fail); border: 1px solid var(--fail-border); }
  .wcag-live .wcag-icon { font-size: 14px; }

  .panel-info {
    padding: 24px;
    display: flex;
    flex-direction: column;
    gap: 20px;
  }

  .info-section h4 {
    font-size: 11px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: var(--text-tertiary);
    margin-bottom: 10px;
  }

  .props-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
  }

  .prop-item {
    background: var(--bg-surface-2);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 8px 10px;
  }

  .prop-key {
    font-size: 10px;
    color: var(--text-tertiary);
    text-transform: uppercase;
    letter-spacing: 0.4px;
    margin-bottom: 2px;
  }

  .prop-val {
    font-size: 13px;
    font-weight: 600;
    color: var(--text-primary);
    font-family: 'SF Mono', monospace;
  }

  .notes-box {
    background: var(--bg-surface-2);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 10px 12px;
    font-size: 12px;
    color: var(--text-secondary);
    line-height: 1.55;
  }

  .notes-box.has-flag {
    background: var(--fail-bg);
    border-color: var(--fail-border);
    color: #7F1D1D;
  }

  .notes-box.has-warn {
    background: var(--warn-bg);
    border-color: var(--warn-border);
    color: #78350F;
  }

  /* â”€â”€ Column headers â”€â”€ */
  .table-headers {
    display: grid;
    grid-template-columns: 220px 140px 80px 80px 90px 100px 1fr auto;
    padding: 0 0 6px;
    margin-bottom: 2px;
  }

  .th {
    padding: 0 14px;
    font-size: 10.5px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: var(--text-tertiary);
  }

  .th:last-child { width: 48px; }

  /* surface color pickers */
  .color-pickers {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-left: auto;
  }

  .color-picker-group {
    display: flex;
    align-items: center;
    gap: 5px;
    font-size: 11.5px;
    color: var(--text-secondary);
  }

  input[type="color"] {
    width: 26px;
    height: 26px;
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 2px;
    cursor: pointer;
    background: none;
  }

  /* stats bar */
  .stats-bar {
    display: flex;
    gap: 20px;
    margin-bottom: 18px;
  }

  .stat {
    background: var(--bg-surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 10px 16px;
    display: flex;
    align-items: center;
    gap: 10px;
    box-shadow: var(--shadow);
  }

  .stat-num {
    font-size: 22px;
    font-weight: 700;
    letter-spacing: -0.5px;
    line-height: 1;
  }

  .stat-label { font-size: 11px; color: var(--text-secondary); }
  .stat-num.red { color: var(--fail); }
  .stat-num.orange { color: var(--warn); }
  .stat-num.green { color: var(--pass); }

</style>
</head>
<body>

<!-- Nav -->
<nav class="topnav">
  <div class="nav-left">
    <div class="fabric-logo">
      <div class="logo-mark">F</div>
      Fabric
    </div>
    <div class="nav-breadcrumb">
      <span class="sep">/</span>
      <span>Core</span>
      <span class="sep">/</span>
      <span>Tokens</span>
      <span class="sep">/</span>
      <span class="current">Typography</span>
    </div>
  </div>
  <div class="nav-right">
    <span class="badge-phase">Phase 1 Â· Typography</span>
  </div>
</nav>

<div class="page">

  <div class="page-header">
    <h1>Type Token Sandbox</h1>
    <p>Preview tokens live, test contrast on different surfaces, and review WCAG 2.2 AA compliance status.</p>
  </div>

  <!-- Stats -->
  <div class="stats-bar">
    <div class="stat"><div class="stat-num red">4</div><div class="stat-label">High priority<br>flags</div></div>
    <div class="stat"><div class="stat-num orange">3</div><div class="stat-label">Medium priority<br>flags</div></div>
    <div class="stat"><div class="stat-num green">9</div><div class="stat-label">Tokens<br>passing</div></div>
    <div class="stat"><div class="stat-num">16</div><div class="stat-label">Total<br>tokens</div></div>
  </div>

  <!-- Controls -->
  <div class="controls-bar">
    <div class="control-group">
      <span class="control-label">Sample text</span>
      <input class="text-input" id="sampleText" type="text" value="The quick brown fox jumps" placeholder="Type sample textâ€¦">
    </div>
    <div class="divider"></div>
    <div class="control-group">
      <span class="control-label">Surface</span>
      <div class="surface-toggle">
        <button class="surface-btn active" id="btn-light" onclick="setSurface('light')">â˜€ Light</button>
        <button class="surface-btn dark-btn" id="btn-dark" onclick="setSurface('dark')">â—‘ Dark</button>
      </div>
    </div>
    <div class="divider"></div>
    <div class="control-group">
      <span class="control-label">Custom colors</span>
      <div class="color-picker-group">
        <label for="bgColor">BG</label>
        <input type="color" id="bgColor" value="#FFFFFF" oninput="updateCustomColors()">
      </div>
      <div class="color-picker-group">
        <label for="fgColor">Text</label>
        <input type="color" id="fgColor" value="#18181B" oninput="updateCustomColors()">
      </div>
    </div>
    <div class="divider"></div>
    <div class="control-group">
      <span class="control-label">Filter</span>
      <div class="filter-pills">
        <button class="pill active" onclick="filterCards('all', this)">All</button>
        <button class="pill high" onclick="filterCards('high', this)">ðŸ”´ High</button>
        <button class="pill medium" onclick="filterCards('medium', this)">ðŸŸ  Medium</button>
        <button class="pill" onclick="filterCards('none', this)">âœ… Passing</button>
      </div>
    </div>
  </div>

  <!-- Column headers -->
  <div class="table-headers">
    <div class="th">Token</div>
    <div class="th">Original</div>
    <div class="th">Size</div>
    <div class="th">Line Ht.</div>
    <div class="th">Tracking</div>
    <div class="th">Weight</div>
    <div class="th">WCAG 2.2 AA</div>
    <div class="th"></div>
  </div>

  <!-- Token cards -->
  <div class="tokens-grid" id="tokensGrid"></div>

</div>

<script>
const tokens = [
  { name:'display-lg',       original:'heading-1',      size:32, lh:40, ls:-0.5, weight:400, wcag:'large',    priority:'none',   notes:'V2 uses regular weight; original heading-1 was bold (700). Negative tracking may impact dyslexic users â€” not a compliance failure but worth monitoring.' },
  { name:'display-sm',       original:'Net New',        size:28, lh:36, ls:-0.5, weight:400, wcag:'large',    priority:'none',   notes:'New token â€” sits between heading-1 and heading-2. Document intended contexts tightly to prevent misuse at small viewports. Same negative tracking caveat as display-lg.', isNew:true },
  { name:'title-lg',         original:'heading-2',      size:24, lh:32, ls:0,    weight:400, wcag:'large',    priority:'none',   notes:'V2 uses regular weight; original heading-2 was bold (700). Qualifies as large text at 24px/400 (â‰¥18pt regular).' },
  { name:'title-md',         original:'heading-3',      size:20, lh:24, ls:0,    weight:400, wcag:'large',    priority:'none',   notes:'V2 uses regular weight; original heading-3 was bold (700). Qualifies as large text at 20px/400 (â‰¥18pt regular).' },
  { name:'title-sm',         original:'heading-4',      size:16, lh:20, ls:0.5,  weight:400, wcag:'standard', priority:'medium', notes:'âš ï¸ Does NOT qualify as large text at 16px/400. Heading-4 was previously 700 which would have qualified for 3:1 â€” engineers migrating from heading-4 may assume the same exemption applies. Must meet 4.5:1 contrast. Do not pair with muted or secondary text colors.' },
  { name:'subtitle-lg',      original:'subheading-1',   size:14, lh:18, ls:0.5,  weight:500, wcag:'standard', priority:'medium', notes:'âš ï¸ Line height is 1.28Ã— â€” below the WCAG-recommended 1.5Ã— minimum. Recommend increasing to 21px. Must meet 4.5:1. If users override line-height via AT, current value creates risk of content overlap.' },
  { name:'subtitle-sm',      original:'subheading-2',   size:12, lh:16, ls:0.5,  weight:500, wcag:'standard', priority:'high',   notes:'ðŸš¨ 12px is the practical legibility floor. Near-identical to caption-medium (12px/500) â€” evaluate whether this token should exist. If retained: must only appear at confirmed 4.5:1 contrast. Never use for critical or actionable content. Line height 1.33Ã— â€” increase to 18px.' },
  { name:'body-lg-regular',  original:'body-1',         size:16, lh:24, ls:0,    weight:400, wcag:'standard', priority:'none',   notes:'Exact match. Line height 1.5Ã— â€” meets WCAG text spacing recommendation.' },
  { name:'body-lg-medium',   original:'body-1-medium',  size:16, lh:24, ls:0,    weight:500, wcag:'standard', priority:'none',   notes:'Exact match. Line height 1.5Ã— â€” meets WCAG text spacing recommendation.' },
  { name:'body-lg-bold',     original:'body-1-bold',    size:16, lh:24, ls:0,    weight:700, wcag:'standard', priority:'none',   notes:'Exact match. 16px/700 is close to large text threshold (14pt bold â‰ˆ 18.66px) but does not qualify. Must still meet 4.5:1.' },
  { name:'body-sm-regular',  original:'body-2',         size:14, lh:20, ls:0,    weight:400, wcag:'standard', priority:'none',   notes:'Highest-volume legacy token â€” maps to body-2 (43.7% of codebase). Line height 1.43Ã— is slightly below 1.5Ã— recommendation. No hard failures but monitor closely given usage volume.' },
  { name:'body-sm-medium',   original:'body-2-medium',  size:14, lh:20, ls:0,    weight:500, wcag:'standard', priority:'medium', notes:'âš ï¸ High-volume token. 14px/500 does NOT qualify as large text. Designers may conflate weight 500 with bold and assume 3:1 â€” it does not apply. Must meet 4.5:1. Large text exemption applies only to body-sm-bold.' },
  { name:'body-sm-bold',     original:'body-2-bold',    size:14, lh:20, ls:0,    weight:700, wcag:'large',    priority:'none',   notes:'14px/700 qualifies as large text (14pt bold threshold). 3:1 contrast applies. Only body-sm token with the large text exemption â€” document this distinction clearly alongside body-sm-medium.' },
  { name:'caption-regular',  original:'subtext',        size:12, lh:16, ls:0,    weight:400, wcag:'standard', priority:'high',   notes:'ðŸš¨ 12px/400 is the most accessibility-risky combination in the scale. Strict 4.5:1 with zero exemptions. Must never be used for critical or actionable content. Only use on surfaces where 4.5:1 is confirmed. Line height 1.33Ã— â€” increase to 18px.' },
  { name:'caption-medium',   original:'subtext-medium', size:12, lh:16, ls:0,    weight:500, wcag:'standard', priority:'high',   notes:'ðŸš¨ Near-identical to subtitle-sm (12px/500) â€” evaluate consolidation. If retained: must meet 4.5:1. Never use for critical or actionable content. Line height 1.33Ã— â€” increase to 18px.' },
  { name:'caption-bold',     original:'subtext-bold',   size:12, lh:16, ls:0,    weight:700, wcag:'standard', priority:'high',   notes:'ðŸš¨ 12px/700 does NOT qualify as large text â€” 14pt bold threshold is â‰ˆ18.66px, not 12px. Even at bold weight, still requires 4.5:1. Same constraints as caption-regular apply. Line height 1.33Ã— â€” increase to 18px.' },
];

// State
let currentSurface = 'light';
let customBg = '#FFFFFF';
let customFg = '#18181B';
let sampleText = 'The quick brown fox jumps';

// Contrast calculation (WCAG relative luminance)
function getLuminance(hex) {
  const r = parseInt(hex.slice(1,3),16)/255;
  const g = parseInt(hex.slice(3,5),16)/255;
  const b = parseInt(hex.slice(5,7),16)/255;
  const toLinear = c => c <= 0.03928 ? c/12.92 : Math.pow((c+0.055)/1.055, 2.4);
  return 0.2126*toLinear(r) + 0.7152*toLinear(g) + 0.0722*toLinear(b);
}

function getContrastRatio(hex1, hex2) {
  const l1 = getLuminance(hex1);
  const l2 = getLuminance(hex2);
  const lighter = Math.max(l1,l2);
  const darker  = Math.min(l1,l2);
  return (lighter + 0.05) / (darker + 0.05);
}

function getCurrentColors() {
  if (currentSurface === 'custom') return { bg: customBg, fg: customFg };
  if (currentSurface === 'dark')  return { bg: '#18181B', fg: '#FAFAFA' };
  return { bg: '#FFFFFF', fg: '#18181B' };
}

function checkWCAG(token) {
  const { bg, fg } = getCurrentColors();
  const ratio = getContrastRatio(bg, fg);
  const required = token.wcag === 'large' ? 3.0 : 4.5;
  return { ratio, required, pass: ratio >= required };
}

// Build cards
function buildCards() {
  const grid = document.getElementById('tokensGrid');
  grid.innerHTML = '';
  tokens.forEach((t, i) => {
    const card = document.createElement('div');
    card.className = `token-card priority-${t.priority}`;
    card.dataset.priority = t.priority;
    card.dataset.index = i;

    const wcagLabel = t.wcag === 'large' ? 'Large text (3:1)' : 'Standard text (4.5:1)';
    const wcagClass = t.wcag === 'large' ? 'wcag-large' : 'wcag-standard';
    const pLabel = t.priority === 'high' ? 'ðŸ”´ High' : t.priority === 'medium' ? 'ðŸŸ  Medium' : 'âœ… Passing';
    const pClass  = t.priority === 'high' ? 'p-high' : t.priority === 'medium' ? 'p-medium' : 'p-none';
    const chipHtml = t.isNew
      ? `<span class="chip chip-new">Net New</span>`
      : `<span class="chip">${t.original}</span>`;

    card.innerHTML = `
      <div class="card-header" onclick="toggleCard(${i})">
        <div class="card-cell token-name-cell">${t.name}</div>
        <div class="card-cell">${chipHtml}</div>
        <div class="card-cell"><div><div class="meta-val">${t.size}px</div></div></div>
        <div class="card-cell"><div class="meta-val">${t.lh}px</div></div>
        <div class="card-cell"><div class="meta-val">${t.ls >= 0 ? '+' : ''}${t.ls}px</div></div>
        <div class="card-cell"><div class="meta-val">${t.weight}</div></div>
        <div class="card-cell" style="gap:8px; flex-wrap:wrap;">
          <span class="wcag-badge ${wcagClass}">${wcagLabel}</span>
          <span class="priority-badge ${pClass}">${pLabel}</span>
        </div>
        <button class="expand-btn" aria-label="Expand">â–¾</button>
      </div>
      <div class="card-panel">
        <div class="panel-preview" id="preview-${i}">
          <div class="preview-label">Live Preview</div>
          <div class="preview-text" id="previewText-${i}" style="font-size:${t.size}px; line-height:${t.lh}px; letter-spacing:${t.ls}px; font-weight:${t.weight};">${sampleText}</div>
          <div class="wcag-live" id="wcagLive-${i}">
            <span class="wcag-icon">â€¦</span>
            <span id="wcagLiveText-${i}">Checking contrastâ€¦</span>
          </div>
        </div>
        <div class="panel-info">
          <div class="info-section">
            <h4>Token Properties</h4>
            <div class="props-grid">
              <div class="prop-item"><div class="prop-key">Font Size</div><div class="prop-val">${t.size}px</div></div>
              <div class="prop-item"><div class="prop-key">Line Height</div><div class="prop-val">${t.lh}px</div></div>
              <div class="prop-item"><div class="prop-key">Letter Spacing</div><div class="prop-val">${t.ls >= 0 ? '+' : ''}${t.ls}px</div></div>
              <div class="prop-item"><div class="prop-key">Font Weight</div><div class="prop-val">${t.weight}</div></div>
              <div class="prop-item"><div class="prop-key">LH Ratio</div><div class="prop-val">${(t.lh/t.size).toFixed(2)}Ã—</div></div>
              <div class="prop-item"><div class="prop-key">Required Contrast</div><div class="prop-val">${t.wcag === 'large' ? '3:1' : '4.5:1'}</div></div>
            </div>
          </div>
          <div class="info-section">
            <h4>Constraints & Notes</h4>
            <div class="notes-box ${t.priority === 'high' ? 'has-flag' : t.priority === 'medium' ? 'has-warn' : ''}">${t.notes}</div>
          </div>
        </div>
      </div>
    `;
    grid.appendChild(card);
  });
  updateAllPreviews();
}

function toggleCard(i) {
  const card = document.querySelector(`[data-index="${i}"]`);
  card.classList.toggle('expanded');
  updatePreview(i);
}

function updatePreview(i) {
  const t = tokens[i];
  const { bg, fg } = getCurrentColors();
  const previewEl = document.getElementById(`preview-${i}`);
  const textEl    = document.getElementById(`previewText-${i}`);
  const liveEl    = document.getElementById(`wcagLive-${i}`);
  const liveTxt   = document.getElementById(`wcagLiveText-${i}`);
  if (!previewEl) return;

  previewEl.style.background = bg;
  textEl.style.color = fg;
  textEl.textContent = document.getElementById('sampleText').value || 'The quick brown fox jumps';

  const { ratio, required, pass } = checkWCAG(t);
  liveEl.className = `wcag-live ${pass ? 'pass' : 'fail'}`;
  liveEl.querySelector('.wcag-icon').textContent = pass ? 'âœ“' : 'âœ—';
  liveTxt.textContent = `Contrast ratio: ${ratio.toFixed(2)}:1 â€” ${pass ? `Passes AA (required ${required}:1)` : `Fails AA (required ${required}:1)`}`;

  if (currentSurface === 'dark') {
    previewEl.classList.add('dark-surface');
  } else {
    previewEl.classList.remove('dark-surface');
  }
}

function updateAllPreviews() {
  tokens.forEach((_, i) => updatePreview(i));
}

function setSurface(mode) {
  currentSurface = mode;
  document.getElementById('btn-light').classList.toggle('active', mode === 'light');
  document.getElementById('btn-dark').classList.toggle('active', mode === 'dark');
  if (mode === 'light') {
    document.getElementById('bgColor').value = '#FFFFFF';
    document.getElementById('fgColor').value = '#18181B';
  } else {
    document.getElementById('bgColor').value = '#18181B';
    document.getElementById('fgColor').value = '#FAFAFA';
  }
  customBg = document.getElementById('bgColor').value;
  customFg = document.getElementById('fgColor').value;
  updateAllPreviews();
}

function updateCustomColors() {
  currentSurface = 'custom';
  document.getElementById('btn-light').classList.remove('active');
  document.getElementById('btn-dark').classList.remove('active');
  customBg = document.getElementById('bgColor').value;
  customFg = document.getElementById('fgColor').value;
  updateAllPreviews();
}

function filterCards(priority, btn) {
  document.querySelectorAll('.pill').forEach(p => p.classList.remove('active'));
  btn.classList.add('active');
  document.querySelectorAll('.token-card').forEach(card => {
    const p = card.dataset.priority;
    card.classList.toggle('hidden', priority !== 'all' && p !== priority);
  });
}

// Live text update
document.addEventListener('DOMContentLoaded', () => {
  buildCards();
  document.getElementById('sampleText').addEventListener('input', updateAllPreviews);
});
</script>
</body>
</html>
